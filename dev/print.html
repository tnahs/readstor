<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js ayu">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>ReadStor</title>
        <meta name="robots" content="noindex" />
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="src/css/custom.css">
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "ayu";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="00-intro/00-intro.html">Introduction</a></li><li class="chapter-item expanded "><a href="01-usage/00-usage.html"><strong aria-hidden="true">1.</strong> Usage</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="01-usage/01-export.html"><strong aria-hidden="true">1.1.</strong> Export</a></li><li class="chapter-item expanded "><a href="01-usage/02-render.html"><strong aria-hidden="true">1.2.</strong> Render</a></li><li class="chapter-item expanded "><a href="01-usage/03-backup.html"><strong aria-hidden="true">1.3.</strong> Backup</a></li><li class="chapter-item expanded "><a href="01-usage/04-options.html"><strong aria-hidden="true">1.4.</strong> Options</a></li></ol></li><li class="chapter-item expanded "><a href="02-templates/00-templates.html"><strong aria-hidden="true">2.</strong> Templates</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="02-templates/01-an-example-template.html"><strong aria-hidden="true">2.1.</strong> An Example Template</a></li><li class="chapter-item expanded "><a href="02-templates/02-00-configuration.html"><strong aria-hidden="true">2.2.</strong> Configuration</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="02-templates/02-01-template-groups.html"><strong aria-hidden="true">2.2.1.</strong> Template Groups</a></li><li class="chapter-item expanded "><a href="02-templates/02-02-context-modes.html"><strong aria-hidden="true">2.2.2.</strong> Context Modes</a></li><li class="chapter-item expanded "><a href="02-templates/02-03-structure-modes.html"><strong aria-hidden="true">2.2.3.</strong> Structure Modes</a></li><li class="chapter-item expanded "><a href="02-templates/02-04-file-extensions.html"><strong aria-hidden="true">2.2.4.</strong> File Extensions</a></li><li class="chapter-item expanded "><a href="02-templates/02-05-name-templates.html"><strong aria-hidden="true">2.2.5.</strong> Name Templates</a></li></ol></li><li class="chapter-item expanded "><a href="02-templates/03-partial-templates.html"><strong aria-hidden="true">2.3.</strong> Partial Templates</a></li><li class="chapter-item expanded "><a href="02-templates/04-backlinks.html"><strong aria-hidden="true">2.4.</strong> Backlinks</a></li><li class="chapter-item expanded "><a href="02-templates/05-string-sanitization.html"><strong aria-hidden="true">2.5.</strong> String Sanitization</a></li><li class="chapter-item expanded "><a href="02-templates/06-00-context-reference.html"><strong aria-hidden="true">2.6.</strong> Context Reference</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="02-templates/06-01-book.html"><strong aria-hidden="true">2.6.1.</strong> Book</a></li><li class="chapter-item expanded "><a href="02-templates/06-02-annotation.html"><strong aria-hidden="true">2.6.2.</strong> Annotation</a></li><li class="chapter-item expanded "><a href="02-templates/06-03-links.html"><strong aria-hidden="true">2.6.3.</strong> Links</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="03-apple-books/00-intro.html"><strong aria-hidden="true">3.</strong> Apple Books</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="03-apple-books/01-backup-library.html"><strong aria-hidden="true">3.1.</strong> Backup Apple Books' Library</a></li><li class="chapter-item expanded "><a href="03-apple-books/02-restore-library.html"><strong aria-hidden="true">3.2.</strong> Restore Apple Books' Library</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu (default)</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">ReadStor</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://www.github.com/tnahs/readstor" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="usage"><a class="header" href="#usage">Usage</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="export"><a class="header" href="#export">Export</a></h1>
<pre><code class="language-plaintext">[ouput-directory]
 │
 ├─ [author-title]
 │   │
 │   ├─ data
 │   │   ├─ book.json
 │   │   └─ annotations.json
 │   │
 │   └─ resources
 │       ├─ .gitkeep
 │       ├─ [author-title].epub   ─┐
 │       ├─ cover.jpeg             ├─ These are not exported.
 │       └─ ...                   ─┘
 │
 ├─ [author-title]
 │   └─ ...
 └─ ...
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="render"><a class="header" href="#render">Render</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="backup"><a class="header" href="#backup">Backup</a></h1>
<pre><code class="language-plaintext">[ouput-directory]
 │
 ├─ [YYYY-MM-DD-HHMMSS-VERSION]
 │   │
 │   ├─ AEAnnotation
 │   │   ├─ AEAnnotation*.sqlite
 │   │   └─ ...
 │   │
 │   └─ BKLibrary
 │       ├─ BKLibrary*.sqlite
 │       └─ ...
 │
 │─ [YYYY-MM-DD-HHMMSS-VERSION]
 │   └─ ...
 └─ ...
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="options"><a class="header" href="#options">Options</a></h1>
<h2 id="global"><a class="header" href="#global">Global</a></h2>
<h3 id="--databases-directory-path"><a class="header" href="#--databases-directory-path"><code>--databases-directory &lt;PATH&gt;</code></a></h3>
<p>Setting a custom database directory:</p>
<p>The <code>databases</code> directory should contains the following structure as this is the
way Apple Books' <code>Documents</code> directory is set up. This is also how backup
directories are created when backing up databases with ReadStor.</p>
<pre><code class="language-plaintext">[databases]
 │
 ├─ AEAnnotation
 │  ├─ AEAnnotation*.sqlite
 │  └─ ...
 │
 ├─ BKLibrary
 │  ├─ BKLibrary*.sqlite
 │  └─ ...
 └─ ...
</code></pre>
<h3 id="--output-directory-path"><a class="header" href="#--output-directory-path"><code>--output-directory &lt;PATH&gt;</code></a></h3>
<h3 id="--force"><a class="header" href="#--force"><code>--force</code></a></h3>
<h3 id="--quiet"><a class="header" href="#--quiet"><code>--quiet</code></a></h3>
<h2 id="template-options"><a class="header" href="#template-options">Template Options</a></h2>
<h3 id="--templates-directory-path"><a class="header" href="#--templates-directory-path"><code>--templates-directory &lt;PATH&gt;</code></a></h3>
<h3 id="--template-group-group"><a class="header" href="#--template-group-group"><code>--template-group &lt;GROUP&gt;</code></a></h3>
<h3 id="--trim-blocks"><a class="header" href="#--trim-blocks"><code>--trim-blocks</code></a></h3>
<h2 id="pre-process-options"><a class="header" href="#pre-process-options">Pre-process Options</a></h2>
<h3 id="--extract-tags"><a class="header" href="#--extract-tags"><code>--extract-tags</code></a></h3>
<h3 id="--normalize-linebreaks"><a class="header" href="#--normalize-linebreaks"><code>--normalize-linebreaks</code></a></h3>
<h3 id="--ascii-all"><a class="header" href="#--ascii-all"><code>--ascii-all</code></a></h3>
<h3 id="--ascii-symbols"><a class="header" href="#--ascii-symbols"><code>--ascii-symbols</code></a></h3>
<!-- [Daring Fireball - SmartyPants](https://daringfireball.net/projects/smartypants/) -->
<!-- [Python-Markdown - SmartyPants](https://python-markdown.github.io/extensions/smarty/) -->
<div style="break-before: page; page-break-before: always;"></div><h1 id="templates"><a class="header" href="#templates">Templates</a></h1>
<p>ReadStor's most powerful feature is the templating interface it provides for
Apple Books. Templates can be designed to output almost any kind of text-based
file format including: Markdown, HTML, CSV. PDFs are possible as well but would
require an extra step to convert an HTML file to the final PDF.</p>
<blockquote>
<p><i class="fa fa-info-circle"></i> See the default <a href="https://github.com/tnahs/readstor/tree/main/templates">templates</a>
for fully working examples.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="an-example-template"><a class="header" href="#an-example-template">An Example Template</a></h1>
<p>The following is a example template along with its expected output and output
structure. In fact it's almost identical to the default template that comes with
ReadStor.</p>
<h2 id="template-syntax"><a class="header" href="#template-syntax">Template Syntax</a></h2>
<p><a href="https://tera.netlify.app/">Tera</a>, a Jinja-flavored templating language, provides a rich set of
tools for building a wide range of template complexities. The following is a
brief intro to the syntax.</p>
<p>Values can be accessed by placing the desired attribute between double
curly-braces:</p>
<pre><code class="language-jinja2">{{ book.author }}
</code></pre>
<p>A list of items can be iterated over using a <code>for</code> loop:</p>
<pre><code class="language-jinja2">{% for annotation in annotations %} ... {% endfor %}
</code></pre>
<p>Conditional behavior can be achieved by using <code>if</code>/<code>else</code> statements:</p>
<pre><code class="language-jinja2">{% if annotation.notes %}notes: {{ annotation.notes }}{% endif %}
</code></pre>
<p>Values can be modified with <code>filters</code>. Here, a list of tags is concatenated with
a space as a delimiter.</p>
<pre><code class="language-jinja2">{{ annotation.tags | join(sep=&quot; &quot;) }}
</code></pre>
<p>And finally comments can be added like so:</p>
<pre><code class="language-jinja2">{# Hi! I'm a comment! #}
</code></pre>
<blockquote>
<p><i class="fa fa-info-circle"></i> See Tera's <a href="https://tera.netlify.app/docs/">documentation</a>
to learn more about these and more advanced features, including template
<a href="https://tera.netlify.app/docs/#inheritance">inheritance</a>, the <a href="https://tera.netlify.app/docs/#include">include</a> tag, <a href="https://tera.netlify.app/docs/#macros">macros</a> and
the full list of available <a href="https://tera.netlify.app/docs/#built-in-filters">filters</a>.</p>
</blockquote>
<h2 id="template"><a class="header" href="#template">Template</a></h2>
<p>Templates consist of two main sections, the configuration block written in YAML
(and some <a href="https://tera.netlify.app/">Tera</a>) and the template body written in <a href="https://tera.netlify.app/">Tera</a>.</p>
<p>The configuration for this example template describes that this template,
grouped under the name <code>my-vault</code>, will render a single file for each book and
place them all directly into the output directory. Each output filename will
follow the pattern of <code>Author - Title.md</code>.</p>
<pre><code class="language-plaintext">&lt;!-- readstor
group: my-vault
context: book
structure: flat
extension: md
name-templates:
  book: &quot;{{ book.author }} - {{ book.title }}&quot;
--&gt;

---
title: {{ book.title }}
author: {{ book.author }}
last-opened: {{ book.metadata.last_opened | date(format=&quot;%Y-%m-%dT%H:%M&quot;) }}
---

# {{ book.author }} - {{ book.title }}

{% for annotation in annotations -%}

---

{{ annotation.body }}

{% if annotation.notes %}notes: {{ annotation.notes }}{% endif -%}
{%- if annotation.tags %}tags: {{ annotation.tags | join(sep=&quot; &quot;) }}{% endif %}

{% endfor %}
</code></pre>
<h2 id="output-structure"><a class="header" href="#output-structure">Output Structure</a></h2>
<p>The output structure is primarily determined by the <code>structure</code> and <code>context</code>
keys. With the <code>structure</code> set to <code>flat</code> all the output files will be placed
inside the <a href="02-templates/../01-usage/02-render.html">output directory</a> with no structure. With the
<code>context</code> set to <code>book</code>, a single file will be created for each book and, if
the template body requests, will contain all its respective annotations. See
<a href="02-templates/./02-02-context-modes.html">Context Modes</a> and <a href="02-templates/./02-03-structure-modes.html">Structure Modes</a> for more
information.</p>
<pre><code class="language-plaintext">[output-directory]
 ├── Krishnamurti - Think on These Things.md
 ├── Richard P. Feynman - &quot;Surely You're Joking, Mr. Feynman!&quot;.md
 └── Robert Henri - The Art Spirit.md
</code></pre>
<h2 id="output-rendered-file"><a class="header" href="#output-rendered-file">Output Rendered File</a></h2>
<h3 id="krishnamurti---think-on-these-thingsmd"><a class="header" href="#krishnamurti---think-on-these-thingsmd"><code>Krishnamurti - Think on These Things.md</code></a></h3>
<pre><code class="language-markdown">---
title: Think on These Things
author: Krishnamurti
last-opened: 2021-11-02T18:30
---

# Krishnamurti - Think on These Things

---

Do you know what intelligence is? It is the capacity, surely, to think freely,
without fear, without a formula, so that you begin to discover for yourself what
is real, what is true; but if you are frightened you will never be intelligent.
Any form of ambition, spiritual or mundane, breeds anxiety, fear; therefore
ambition does not help to bring about a mind that is clear, simple, direct, and
hence intelligent.

tags: #education #intelligence #ambition #fear

---

To find out is not to come to a conclusion. I don’t know if you see the
difference. The moment you come to a conclusion as to what intelligence is, you
cease to be intelligent. That is what most of the older people have done: they
have come to conclusions. Therefore they have ceased to be intelligent. So you
have found out one thing right off: that an intelligent mind is one which is
constantly learning, never concluding.

tags: #learning #intelligence

---

The deeper the mind penetrates its own thought processes, the more clearly it
understands that all forms of thinking are conditioned; therefore the mind is
spontaneously very still—which does not mean that it is asleep. On the contrary,
the mind is then extraordinarily alert, no longer being drugged by mantrams, by
the repetition of words, or shaped by discipline. This state of silent alertness
is also part of awareness; and if you go into it still more deeply you will find
that there is no division between the person who is aware and the object of
which he is aware.

tags: #thinking
</code></pre>
<h3 id="richard-p-feynman---surely-youre-joking-mr-feynmanmd"><a class="header" href="#richard-p-feynman---surely-youre-joking-mr-feynmanmd"><code>Richard P. Feynman - &quot;Surely You're Joking, Mr. Feynman!&quot;.md</code></a></h3>
<pre><code class="language-markdown">---
title: &quot;Surely You're Joking, Mr. Feynman!&quot;
author: Richard P. Feynman
last-opened: 2021-11-02T18:27
---

# Richard P. Feynman - &quot;Surely You're Joking, Mr. Feynman!&quot;

---

After the dinner we went off into another room, where there were different
conversations going on. There was a Princess Somebody of Denmark sitting at a
table with a number of people around her, and I saw an empty chair at their
table and sat down.

She turned to me and said, “Oh! You’re one of the Nobel-Prize-winners. In what
field did you do your work?”

“In physics,” I said.

“Oh. Well, nobody knows anything about that, so I guess we can’t talk about it.”

“On the contrary,” I answered. “It’s because somebody knows something about it
that we can’t talk about physics. It’s the things that nobody knows anything
about that we can discuss. We can talk about the weather; we can talk about
social problems; we can talk about psychology; we can talk about international
finance—gold transfers we can’t talk about, because those are understood—so it’s
the subject that nobody knows anything about that we can all talk about!”

I don’t know how they do it. There’s a way of forming ice on the surface of the
face, and she did it! She turned to talk to somebody else.
</code></pre>
<h3 id="robert-henri---the-art-spiritmd"><a class="header" href="#robert-henri---the-art-spiritmd"><code>Robert Henri - The Art Spirit.md</code></a></h3>
<pre><code class="language-plaintext">---
title: The Art Spirit
author: Robert Henri
last-opened: 2021-11-02T18:27
---

# Robert Henri - The Art Spirit

---

We are not here to do what has already been done.

---

The object of painting a picture is not to make a picture—however unreasonable
this may sound. The picture, if a picture results, is a by-product and may be
useful, valuable, interesting as a sign of what has past. The object, which is
back of every true work of art, is the attainment of a state of being, a state
of high functioning, a more than ordinary moment of existence. In such moments
activity is inevitable, and whether this activity is with brush, pen, chisel, or
tongue, its result is but a by-product of the state, a trace, the footprint of
the state.

tags: #artist #being

---

Of course it is not easy to go one’s road. Because of our education we
continually get off our track, but the fight is a good one and there is joy in
it if there is any success at all. After all, the goal is not making art. It is
living a life. Those who live their lives will leave the stuff that is really
art. Art is a result. It is the trace of those who have led their lives. It is
interesting to us because we read the struggle and the degree of success the man
made in his struggle to live. The great question is: “What is worth while?” The
majority of people have failed to ask themselves seriously enough, and have
failed to try seriously enough to answer this question.

---

Do not let the fact that things are not made for you, that conditions are not as
they should be, stop you. Go on anyway. Everything depends on those who go on
anyway.

tags: #inspiration
</code></pre>
<!-- TODO: Update `output-directory` when the usage docs are completed. -->
<div style="break-before: page; page-break-before: always;"></div><h1 id="configuration"><a class="header" href="#configuration">Configuration</a></h1>
<p>A template's configuration describes both what the template expects to render
and how the output structure and naming should be.
Every template must start with a configuration block.</p>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>The configuration starts off as a basic HTML comment tag...</p>
<pre><code class="language-markdown">&lt;!-- --&gt;
</code></pre>
<p>... with the word <code>readstor</code>...</p>
<pre><code class="language-markdown">&lt;!-- readstor --&gt;
</code></pre>
<p>...and a new line.</p>
<pre><code class="language-markdown">&lt;!-- readstor

--&gt;
</code></pre>
<p>The YAML configuration is then placed inside the tag. For example:</p>
<pre><code class="language-markdown">&lt;!-- readstor
group: my-vault
context: book
structure: nested
extension: md
name-templates:
  book: &quot;{{ book.author }} - {{ book.title }}&quot;
  annotation: &quot;{{ annotation.metadata.slugs.created }}-{{ book.slugs.title }}&quot;
  directory: &quot;{{ book.author }} - {{ book.title }}&quot;
--&gt;

...
</code></pre>
<blockquote>
<p><i class="fa fa-exclamation-circle"></i> Note that the final rendered output
file will not include its template's configuration. Additionally, if the
configuration ended with trailing linebreaks, a single one of them is
removed. This allow for some extra whitespace while working with a template
without affecting final rendered output.</p>
</blockquote>
<p>A quick rundown of each configuration key:</p>
<div class="table-wrapper"><table><thead><tr><th>Key</th><th>Description</th></tr></thead><tbody>
<tr><td><code>group</code></td><td>The <a href="02-templates/./02-01-template-groups.html">Template Group</a> name.</td></tr>
<tr><td><code>context</code></td><td>The <a href="02-templates/./02-02-context-modes.html">Context Mode</a> or what the template will render.</td></tr>
<tr><td><code>structure</code></td><td>The <a href="02-templates/./02-03-structure-modes.html">Structure Mode</a> or how the output files will be structured.</td></tr>
<tr><td><code>extension</code></td><td>The template's output <a href="02-templates/./02-04-file-extensions.html">File Extension</a>.</td></tr>
<tr><td><code>name-templates</code></td><td>The <a href="02-templates/./02-05-name-templates.html">Name Templates</a> for generating file and directory names.</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="template-groups"><a class="header" href="#template-groups">Template Groups</a></h1>
<div class="table-wrapper"><table><thead><tr><th></th><th></th></tr></thead><tbody>
<tr><td>Name</td><td><code>group</code></td></tr>
<tr><td>Type</td><td>string</td></tr>
<tr><td>Valid Values</td><td>any</td></tr>
<tr><td>Required</td><td><i class="fa fa-check"></i></td></tr>
<tr><td>Default</td><td>-</td></tr>
</tbody></table>
</div>
<p>Groups are used to identify multiple templates that are intended to be part
of a single output. Conversely, they also provide a way to separate unrelated
templates rendered to the same output directory. The most common use case would
be when using a pair of templates where one is used to render a book and the
other to render each of its annotations separately.</p>
<blockquote>
<p><i class="fa fa-exclamation-circle"></i> Group names are sanitized to make sure
they interact well with the file system. See
<a href="02-templates/./05-string-sanitization.html">String Sanitization</a> for more information.</p>
</blockquote>
<p>Grouping is triggered when one or more templates are set to either the
<code>flat-grouped</code> or the <code>nested-grouped</code> <a href="02-templates/./02-03-structure-modes.html">Structure Mode</a>.
The output files are placed within a directory named after the <code>group</code>.</p>
<p>For example, if two templates share these values in their configurations:</p>
<pre><code class="language-yaml">group: my-vault
structure: flat-grouped
</code></pre>
<p>The output will be:</p>
<pre><code class="language-plaintext">[output-directory]
 ├── my-vault
 │    ├── 2021-11-02-180445-the-art-spirit.md
 │    ├── 2021-11-02-181250-the-art-spirit.md
 │    ├── 2021-11-02-181325-the-art-spirit.md
 │    ├── 2021-11-02-181510-the-art-spirit.md
 │    ├── 2021-11-02-182059-surely-youre-joking-mr-feynman.md
 │    ├── 2021-11-02-182319-think-on-these-things.md
 │    ├── 2021-11-02-182426-think-on-these-things.md
 │    ├── 2021-11-02-182543-think-on-these-things.md
 │    ├── 2021-11-02-182648-think-on-these-things.md
 │    ├── 2021-11-02-182805-think-on-these-things.md
 │    ├── Krishnamurti - Think on These Things.md
 │    ├── Richard P. Feynman - &quot;Surely You're Joking, Mr. Feynman!&quot;.md
 │    └── Robert Henri - The Art Spirit.md
 │
 ├── [other-group]
 │    └── ...
 └── ...
</code></pre>
<p>And, if two templates share these values in their configurations:</p>
<pre><code class="language-yaml">group: my-vault
structure: nested-grouped
</code></pre>
<p>The output will be:</p>
<pre><code class="language-plaintext">[output-directory]
 ├── my-vault
 │    ├── Krishnamurti - Think on These Things
 │    │    ├── 2021-11-02-182319-think-on-these-things.md
 │    │    ├── 2021-11-02-182426-think-on-these-things.md
 │    │    ├── 2021-11-02-182543-think-on-these-things.md
 │    │    ├── 2021-11-02-182648-think-on-these-things.md
 │    │    ├── 2021-11-02-182805-think-on-these-things.md
 │    │    └── Krishnamurti - Think on These Things.md
 │    ├── Richard P. Feynman - &quot;Surely You're Joking, Mr. Feynman!&quot;
 │    │    ├── 2021-11-02-182059-surely-youre-joking-mr-feynman.md
 │    │    └── Richard P. Feynman - &quot;Surely You're Joking, Mr. Feynman!&quot;.md
 │    └── Robert Henri - The Art Spirit
 │         ├── 2021-11-02-180445-the-art-spirit.md
 │         ├── 2021-11-02-181250-the-art-spirit.md
 │         ├── 2021-11-02-181325-the-art-spirit.md
 │         ├── 2021-11-02-181510-the-art-spirit.md
 │         └── Robert Henri - The Art Spirit.md`
 │
 ├── [other-group]
 │    └── ...
 └── ...
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="context-modes"><a class="header" href="#context-modes">Context Modes</a></h1>
<div class="table-wrapper"><table><thead><tr><th></th><th></th></tr></thead><tbody>
<tr><td>Name</td><td><code>context</code></td></tr>
<tr><td>Type</td><td>string</td></tr>
<tr><td>Valid Values</td><td><code>book</code> <code>annotation</code></td></tr>
<tr><td>Required</td><td><i class="fa fa-check"></i></td></tr>
<tr><td>Default</td><td>-</td></tr>
</tbody></table>
</div>
<p>At render time, each template is injected with a &quot;context&quot;, in other words, the
data it will render. ReadStor provides two different context modes: <code>book</code>
and <code>annotation</code>. The context mode dictates not just the data within the context
but also changes the number of output files. See
<a href="02-templates/02-02-context-modes.html#a-note-on-output-structure">A Note On Output Structure</a> for more information.</p>
<h2 id="the-book-context"><a class="header" href="#the-book-context">The Book Context</a></h2>
<div class="table-wrapper"><table><thead><tr><th></th><th></th></tr></thead><tbody>
<tr><td>Context Mode</td><td><code>book</code></td></tr>
<tr><td>Context Objects</td><td><a href="02-templates/./06-01-book.html"><code>book</code></a> <a href="02-templates/./06-02-annotation.html"><code>annotations</code></a> <a href="02-templates/./06-03-links.html"><code>links</code></a></td></tr>
<tr><td>Ouput Files</td><td>=1</td></tr>
</tbody></table>
</div>
<blockquote>
<p><i class="fa fa-info-circle"></i> Note that <code>annotations</code> is plural in the
<code>book</code> context.</p>
</blockquote>
<p>When selected, a single file is rendered out from a context containing the data
from a single book and its annotations. For example, represented here in YAML:</p>
<pre><code class="language-yaml">book:
  title: The Art Spirit
  author: Robert Henri
  metadata:
    id: 1969AF0ECA8AE4965029A34316813924
    last_opened: 2021-11-02T18:27:04.781938076Z
  slugs:
    title: the-art-spirit
    author: robert-henri
annotations:
  - body: We are not here to do what has already been done.
    style: purple
    notes: &quot;&quot;
    tags: []
    metadata:
      id: C932CE69-8584-4555-834C-797DF84E6825
      book_id: 1969AF0ECA8AE4965029A34316813924
      created: 2021-11-02T18:12:50.826642036Z
      modified: 2021-11-02T18:12:51.831905841Z
      location: 6.18.4.2.20.2.1:0
      epubcfi: epubcfi(/6/18[c_9780465008575_ps_Part09_Split0]!/4/2/20/2/1,:0,:49)
      slugs:
        created: 2021-11-02-181250
        modified: 2021-11-02-181250
  - body: The object of painting a picture...
    style: yellow
    notes: &quot;&quot;
    tags:
      - &quot;#artist&quot;
      - &quot;#being&quot;
    metadata:
      id: 3FCC630A-55E6-4D6F-8E8F-DAD7C4E20A1C
      book_id: 1969AF0ECA8AE4965029A34316813924
      created: 2021-11-02T18:13:25.905355930Z
      modified: 2021-11-02T18:14:12.444134950Z
      location: 6.24.4.2.296.2.1:0
      epubcfi: epubcfi(/6/24[c_9780465008575_ps_Part09_Split3]!/4/2/296/2,/1:0,/7:257)
      slugs:
        created: 2021-11-02-181325
        modified: 2021-11-02-181325
  # ...
links:
  book: Robert Henri - The Art Spirit.md
  annotations:
    C932CE69-8584-4555-834C-797DF84E6825: 2021-11-02-181250-the-art-spirit.md
    3FCC630A-55E6-4D6F-8E8F-DAD7C4E20A1C: 2021-11-02-181325-the-art-spirit.md
    # ...
  directory: Robert Henri - The Art Spirit
</code></pre>
<blockquote>
<p><i class="fa fa-exclamation-circle"></i> See <a href="02-templates/./06-01-book.html">Context Reference - Book</a>
for more information.</p>
</blockquote>
<h2 id="the-annotation-context"><a class="header" href="#the-annotation-context">The Annotation Context</a></h2>
<div class="table-wrapper"><table><thead><tr><th></th><th></th></tr></thead><tbody>
<tr><td>Context Mode</td><td><code>annotation</code></td></tr>
<tr><td>Context Objects</td><td><a href="02-templates/./06-01-book.html"><code>book</code></a> <a href="02-templates/./06-02-annotation.html"><code>annotation</code></a> <a href="02-templates/./06-03-links.html"><code>links</code></a></td></tr>
<tr><td>Ouput Files</td><td>&gt;=1</td></tr>
</tbody></table>
</div>
<p>When selected, multiple files are rendered out from a context containing a the
data from a single annotation and its respective book. For example, represented
here in YAML:</p>
<pre><code class="language-yaml">book:
  title: The Art Spirit
  author: Robert Henri
  metadata:
    id: 1969AF0ECA8AE4965029A34316813924
    last_opened: 2021-11-02T18:27:04.781938076Z
  slugs:
    title: the-art-spirit
    author: robert-henri
annotation:
  body: We are not here to do what has already been done.
  style: purple
  notes: &quot;&quot;
  tags: []
  metadata:
    id: C932CE69-8584-4555-834C-797DF84E6825
    book_id: 1969AF0ECA8AE4965029A34316813924
    created: 2021-11-02T18:12:50.826642036Z
    modified: 2021-11-02T18:12:51.831905841Z
    location: 6.18.4.2.20.2.1:0
    epubcfi: epubcfi(/6/18[c_9780465008575_ps_Part09_Split0]!/4/2/20/2/1,:0,:49)
    slugs:
      created: 2021-11-02-181250
      modified: 2021-11-02-181250
links:
  book: Robert Henri - The Art Spirit.md
  annotations:
    C932CE69-8584-4555-834C-797DF84E6825: 2021-11-02-181250-the-art-spirit.md
  directory: Robert Henri - The Art Spirit
</code></pre>
<blockquote>
<p><i class="fa fa-exclamation-circle"></i> See
<a href="02-templates/./06-02-annotation.html">Context Reference - Annotation</a> for more information.</p>
</blockquote>
<h2 id="a-note-on-output-structure"><a class="header" href="#a-note-on-output-structure"><i class="fa fa-exclamation-circle"></i> A Note On Output Structure</a></h2>
<p>When selecting a context mode it's important to understand how the output files
will look. The following is a quick visualization.</p>
<p>When the context mode is set to <code>book</code>, a single file for each book is rendered
out from the template. Using the following configuration keys:</p>
<pre><code class="language-yaml">context: book
structure: nested
</code></pre>
<p>The output structure is as follows:</p>
<pre><code class="language-plaintext">[output-directory]
 ├── Krishnamurti - Think on These Things
 │    └── Krishnamurti - Think on These Things.md
 ├── Richard P. Feynman - &quot;Surely You're Joking, Mr. Feynman!&quot;
 │    └── Richard P. Feynman - &quot;Surely You're Joking, Mr. Feynman!&quot;.md
 └── Robert Henri - The Art Spirit
      └── Robert Henri - The Art Spirit.md`
</code></pre>
<p>And when the context mode is set to <code>annotation</code>, multiple files are rendered
out, one for each annotation within a book. Using the following configuration
keys:</p>
<pre><code class="language-yaml">context: annotation
structure: nested
</code></pre>
<p>The output structure is as follows:</p>
<pre><code class="language-plaintext">[output-directory]
 ├── Krishnamurti - Think on These Things
 │    ├── 2021-11-02-182319-think-on-these-things.md
 │    ├── 2021-11-02-182426-think-on-these-things.md
 │    ├── 2021-11-02-182543-think-on-these-things.md
 │    ├── 2021-11-02-182648-think-on-these-things.md
 │    └── 2021-11-02-182805-think-on-these-things.md
 ├── Richard P. Feynman - &quot;Surely You're Joking, Mr. Feynman!&quot;
 │    └── 2021-11-02-182059-surely-youre-joking-mr-feynman.md
 └── Robert Henri - The Art Spirit
      ├── 2021-11-02-180445-the-art-spirit.md
      ├── 2021-11-02-181250-the-art-spirit.md
      ├── 2021-11-02-181325-the-art-spirit.md
      └── 2021-11-02-181510-the-art-spirit.md
</code></pre>
<p>When both templates are rendered to the same directory, we get a complete
output with a book and each of its annotations all rendered out to their own
file.</p>
<pre><code class="language-plaintext">[output-directory]
 ├── Krishnamurti - Think on These Things
 │    ├── 2021-11-02-182319-think-on-these-things.md
 │    ├── 2021-11-02-182426-think-on-these-things.md
 │    ├── 2021-11-02-182543-think-on-these-things.md
 │    ├── 2021-11-02-182648-think-on-these-things.md
 │    ├── 2021-11-02-182805-think-on-these-things.md
 │    └── Krishnamurti - Think on These Things.md
 ├── Richard P. Feynman - &quot;Surely You're Joking, Mr. Feynman!&quot;
 │    ├── 2021-11-02-182059-surely-youre-joking-mr-feynman.md
 │    └── Richard P. Feynman - &quot;Surely You're Joking, Mr. Feynman!&quot;.md
 └── Robert Henri - The Art Spirit
      ├── 2021-11-02-180445-the-art-spirit.md
      ├── 2021-11-02-181250-the-art-spirit.md
      ├── 2021-11-02-181325-the-art-spirit.md
      ├── 2021-11-02-181510-the-art-spirit.md
      └── Robert Henri - The Art Spirit.md
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="structure-modes"><a class="header" href="#structure-modes">Structure Modes</a></h1>
<div class="table-wrapper"><table><thead><tr><th></th><th></th></tr></thead><tbody>
<tr><td>Name</td><td><code>ouput</code></td></tr>
<tr><td>Type</td><td>string</td></tr>
<tr><td>Valid Values</td><td><code>flat</code> <code>flat-grouped</code> <code>nested</code> <code>nested-grouped</code></td></tr>
<tr><td>Required</td><td><i class="fa fa-check"></i></td></tr>
<tr><td>Default</td><td>-</td></tr>
</tbody></table>
</div>
<p>The structure mode determines how the output directories and files are
structured. ReadStor provides four structure modes: <code>flat</code>, <code>flat-grouped</code>,
<code>nested</code> and <code>nested-grouped</code>.</p>
<h2 id="flat-mode"><a class="header" href="#flat-mode">Flat Mode</a></h2>
<pre><code class="language-yaml">structure: flat
</code></pre>
<p>When selected, the template is rendered to the output directory without any
structure. All the files are placed directly within the output directory. No
additional directories are created.</p>
<pre><code class="language-plaintext">[output-directory]
 ├── Krishnamurti - Think on These Things.md
 ├── Richard P. Feynman - &quot;Surely You're Joking, Mr. Feynman!&quot;.md
 ├── Robert Henri - The Art Spirit.md
 └── ...
</code></pre>
<h2 id="flat--grouped-mode"><a class="header" href="#flat--grouped-mode">Flat &amp; Grouped Mode</a></h2>
<pre><code class="language-yaml">group: my-vault
structure: flat-grouped
</code></pre>
<p>When selected, the template is rendered to the output directory and placed
inside a directory named after its <code>group</code>. This is useful if multiple template
groups are being rendered to the same directory.</p>
<pre><code class="language-plaintext">[output-directory]
 └── my-vault
      ├── Krishnamurti - Think on These Things.md
      ├── Richard P. Feynman - &quot;Surely You're Joking, Mr. Feynman!&quot;.md
      ├── Robert Henri - The Art Spirit.md
      └── ...
</code></pre>
<h2 id="nested-mode"><a class="header" href="#nested-mode">Nested Mode</a></h2>
<pre><code class="language-yaml">structure: nested
</code></pre>
<p>When selected, the template is rendered to the
<a href="02-templates/../01-usage/02-render.html">output directory</a> and placed inside a directory named after
the <code>name-templates.directory</code> key. This is useful if a template group contains
multiple templates.</p>
<pre><code class="language-plaintext">[output-directory]
 ├── Krishnamurti - Think on These Things
 │    ├── 2021-11-02-182319-think-on-these-things.md
 │    ├── 2021-11-02-182426-think-on-these-things.md
 │    ├── 2021-11-02-182543-think-on-these-things.md
 │    ├── 2021-11-02-182648-think-on-these-things.md
 │    ├── 2021-11-02-182805-think-on-these-things.md
 │    └── Krishnamurti - Think on These Things.md
 ├── Richard P. Feynman - &quot;Surely You're Joking, Mr. Feynman!&quot;
 │    ├── 2021-11-02-182059-surely-youre-joking-mr-feynman.md
 │    └── Richard P. Feynman - &quot;Surely You're Joking, Mr. Feynman!&quot;.md
 ├── Robert Henri - The Art Spirit
 │    ├── 2021-11-02-180445-the-art-spirit.md
 │    ├── 2021-11-02-181250-the-art-spirit.md
 │    ├── 2021-11-02-181325-the-art-spirit.md
 │    ├── 2021-11-02-181510-the-art-spirit.md
 │    └── Robert Henri - The Art Spirit.md`
 └── ...
</code></pre>
<h2 id="nested--grouped-mode"><a class="header" href="#nested--grouped-mode">Nested &amp; Grouped Mode</a></h2>
<pre><code class="language-yaml">group: my-vault
structure: nested-grouped
</code></pre>
<p>When selected, the template is rendered to the
<a href="02-templates/../01-usage/02-render.html">output directory</a> and placed inside a directory named after
its <code>group</code> and another named after the <code>name-templates.directory</code> key. This is
useful if multiple template groups are being rendered to the same directory and
if a template group contains multiple templates.</p>
<pre><code class="language-plaintext">[output-directory]
 └── my-vault
      ├── Krishnamurti - Think on These Things
      │    ├── 2021-11-02-182319-think-on-these-things.md
      │    ├── 2021-11-02-182426-think-on-these-things.md
      │    ├── 2021-11-02-182543-think-on-these-things.md
      │    ├── 2021-11-02-182648-think-on-these-things.md
      │    ├── 2021-11-02-182805-think-on-these-things.md
      │    └── Krishnamurti - Think on These Things.md
      ├── Richard P. Feynman - &quot;Surely You're Joking, Mr. Feynman!&quot;
      │    ├── 2021-11-02-182059-surely-youre-joking-mr-feynman.md
      │    └── Richard P. Feynman - &quot;Surely You're Joking, Mr. Feynman!&quot;.md
      └── Robert Henri - The Art Spirit
           ├── 2021-11-02-180445-the-art-spirit.md
           ├── 2021-11-02-181250-the-art-spirit.md
           ├── 2021-11-02-181325-the-art-spirit.md
           ├── 2021-11-02-181510-the-art-spirit.md
           └── Robert Henri - The Art Spirit.md
</code></pre>
<!-- TODO: Update `output-directory` when the usage docs are completed. -->
<div style="break-before: page; page-break-before: always;"></div><h1 id="extension"><a class="header" href="#extension">Extension</a></h1>
<div class="table-wrapper"><table><thead><tr><th></th><th></th></tr></thead><tbody>
<tr><td>Name</td><td><code>extension</code></td></tr>
<tr><td>Type</td><td>string</td></tr>
<tr><td>Valid Values</td><td>any</td></tr>
<tr><td>Required</td><td><i class="fa fa-check"></i></td></tr>
<tr><td>Default</td><td>-</td></tr>
</tbody></table>
</div>
<p>Defines the template's output file extension. Note that this will be appended to
all the output filenames with the format <code>[filename].[extension]</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="name-templates"><a class="header" href="#name-templates">Name Templates</a></h1>
<div class="table-wrapper"><table><thead><tr><th>Key</th><th>Context</th></tr></thead><tbody>
<tr><td><code>name-templates.book</code></td><td><code>book</code></td></tr>
<tr><td><code>name-templates.annotation</code></td><td><code>annotation</code></td></tr>
<tr><td><code>name-templates.directory</code></td><td><code>book</code></td></tr>
</tbody></table>
</div>
<p>Output files and directory names can be customized using the same <a href="https://tera.netlify.app/">Tera</a>
syntax. ReadStor will inject a different context into each <code>name-template</code>
during render time and set the template's output file/directory name to the
resulting string.</p>
<blockquote>
<p><i class="fa fa-exclamation-circle"></i> The rendered book, annotation and
directory names are sanitized to make sure they interact well with the file
system. See <a href="02-templates/./05-string-sanitization.html">String Sanitization</a> for more information.</p>
</blockquote>
<p>Additionally, all the rendered values from these keys are available within the
template's context under the <code>links</code> variable regardless of the current context
mode. See <a href="02-templates/./06-03-links.html">Context Reference - Links</a> for more information.</p>
<blockquote>
<p><i class="fa fa-exclamation-circle"></i> Note that the template's <code>context</code>
matters when setting <code>name-templates</code>.</p>
<p>For example, if the template's <code>context</code> is set to <code>book</code>:</p>
<pre><code class="language-yaml">group: my-vault
structure: flat
context: book # &lt;- Here!
extension: md
name-templates:
  book: &quot;{{ book.author }} - {{ book.title }}&quot;
  annotation: &quot;{{ annotation.metadata.slugs.created }}-{{ book.slugs.title }}&quot;
</code></pre>
<p>ReadStor will generate a single file for each book and name them using the
rendered result of <code>name-templates.book</code>. The resulting output would be:</p>
<pre><code class="language-plaintext">[output-directory]
 ├── Krishnamurti - Think on These Things.md
 ├── Richard P. Feynman - &quot;Surely You're Joking, Mr. Feynman!&quot;.md
 ├── Robert Henri - The Art Spirit.md
 └── ...
</code></pre>
<p>However if the <code>context</code> is changed to <code>annotation</code>:</p>
<pre><code class="language-yaml">group: my-vault
structure: flat
context: annotation # &lt;- Here!
extension: md
name-templates:
  book: &quot;{{ book.author }} - {{ book.title }}&quot;
  annotation: &quot;{{ annotation.metadata.slugs.created }}-{{ book.slugs.title }}&quot;
</code></pre>
<p>ReadStor will now generate a single file for each annotation in each book
and name them using the rendered result of <code>name-templates.annotation</code>. The
resulting output would be:</p>
<pre><code class="language-plaintext">[output-directory]
 ├── 2021-11-02-180445-the-art-spirit.md
 ├── 2021-11-02-181250-the-art-spirit.md
 ├── 2021-11-02-181325-the-art-spirit.md
 ├── 2021-11-02-181510-the-art-spirit.md
 ├── 2021-11-02-182059-surely-youre-joking-mr-feynman.md
 ├── 2021-11-02-182319-think-on-these-things.md
 ├── 2021-11-02-182426-think-on-these-things.md
 ├── 2021-11-02-182543-think-on-these-things.md
 ├── 2021-11-02-182648-think-on-these-things.md
 ├── 2021-11-02-182805-think-on-these-things.md
 └── ...
</code></pre>
</blockquote>
<h2 id="book-name-template"><a class="header" href="#book-name-template">Book Name Template</a></h2>
<p>Defines the file name template to use when the parent template's <code>context</code>
mode is set to <code>book</code>. This template only has access to the <code>book</code> context when
its rendered.</p>
<div class="table-wrapper"><table><thead><tr><th></th><th></th></tr></thead><tbody>
<tr><td>Name</td><td><code>name-templates.book</code></td></tr>
<tr><td>Type</td><td>string</td></tr>
<tr><td>Valid Values</td><td>any</td></tr>
<tr><td>Required</td><td>No</td></tr>
<tr><td>Default</td><td><code>{{ book.author }} - {{ book.title }}</code></td></tr>
</tbody></table>
</div>
<h2 id="annotation-name-template"><a class="header" href="#annotation-name-template">Annotation Name Template</a></h2>
<p>Defines the file name template to use when the parent template's <code>context</code> mode
is set to <code>annotation</code>. This template has access to the <code>book</code> and <code>annotation</code>
context when its rendered.</p>
<div class="table-wrapper"><table><thead><tr><th></th><th></th></tr></thead><tbody>
<tr><td>Name</td><td><code>name-templates.annotation</code></td></tr>
<tr><td>Type</td><td>string</td></tr>
<tr><td>Valid Values</td><td>any</td></tr>
<tr><td>Required</td><td>No</td></tr>
<tr><td>Default</td><td><code>{{ annotation.metadata.slugs.created }}-{{ book.slugs.title }}</code></td></tr>
</tbody></table>
</div>
<h2 id="directory-name-template"><a class="header" href="#directory-name-template">Directory Name Template</a></h2>
<p>Defines the directory name template to use when the parent template's
<code>structure</code> mode is set to <code>nested</code> or the <code>nested-grouped</code>. This template only
has access to the <code>book</code> context when its rendered.</p>
<div class="table-wrapper"><table><thead><tr><th></th><th></th></tr></thead><tbody>
<tr><td>Name</td><td><code>name-templates.directory</code></td></tr>
<tr><td>Type</td><td>string</td></tr>
<tr><td>Valid Values</td><td>any</td></tr>
<tr><td>Required</td><td>No</td></tr>
<tr><td>Default</td><td><code>{{ book.author }} - {{ book.title }}</code></td></tr>
</tbody></table>
</div>
<h2 id="limitations"><a class="header" href="#limitations"><i class="fa fa-exclamation-circle"></i> Limitations</a></h2>
<p>Why does a single template have both a <code>name-templates.book</code> and
<code>name-templates.annotation</code> key?</p>
<p>This is mainly the result of a current limitation with ReadStor. Templates
that are part of the same <code>group</code> have no relation internally. ReadStor just
renders each template it finds. If multiple templates share the same value for
<code>group</code> then they end up in the same directory when the <code>structure</code> mode is set
to <code>grouped</code> or <code>nested-grouped</code>.</p>
<p>As a result of this limitation, if a template requires awareness of its
<code>group</code>'s sibling template names i.e. <a href="02-templates/./06-03-links.html"><code>links</code></a>, they <em>must</em> be defined
in each template. This results in some duplication across templates. This
should hopefully be resolved in future versions of ReadStor.</p>
<blockquote>
<p><i class="fa fa-info-circle"></i> For more information on how to generate and
use <code>links</code> see <a href="02-templates/./06-03-links.html">Context Reference - Links</a> and <a href="02-templates/./04-backlinks.html">Backlinks</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="partial-templates"><a class="header" href="#partial-templates">Partial Templates</a></h1>
<p>When working with larger templates it can be helpful to separate them into
smaller building blocks. One way to do this is to create partial templates and
<code>include</code> them in other templates.</p>
<p>Partial templates differ in two important ways from their normal template
counterparts.</p>
<ol>
<li>
<p>They <em>must</em> begin with an underscore <code>_</code> as this is currently the only
indicator of whether a template is partial or not.</p>
</li>
<li>
<p>They require no configuration block as they inherit their configuration from
the template that <code>include</code>s them.</p>
</li>
</ol>
<blockquote>
<p><i class="fa fa-info-circle"></i> See the <a href="https://github.com/tnahs/readstor/tree/main/templates/using-partials">using-partials</a>
templates for a fully working example.</p>
</blockquote>
<h2 id="including-a-partial-template"><a class="header" href="#including-a-partial-template">Including a Partial Template</a></h2>
<p>Partial templates are included using the <code>include</code> tag:</p>
<pre><code class="language-jinja2">{% include &quot;_my-partial-template.md&quot; %}
</code></pre>
<p>Where <code>&quot;_my-partial-template.md&quot;</code> is a path relative to to the
<a href="02-templates//01-usage/02-render.html">templates directory</a>. Therefore, this would be pointing
to a template at the root of the <a href="02-templates//01-usage/02-render.html">templates directory</a>.
If we wanted to organize our templates into different directories we would
have to add the directory names for any directories between the including
template and the <a href="02-templates//01-usage/02-render.html">templates directory</a>.</p>
<p>For example, with the following structure:</p>
<pre><code class="language-plaintext">[templates-directory]
 └── my-vault-templates
      ├── _annotation.md
      ├── _book.md
      └── template.md
</code></pre>
<p>We would use the following <code>include</code> tags:</p>
<pre><code class="language-jinja2">{% include &quot;my-vault-templates/_book.jinja2&quot; %}
{% include &quot;my-vault-templates/_annotation.jinja2&quot; %}
</code></pre>
<blockquote>
<p><i class="fa fa-info-circle"></i> See the documentation for <a href="https://tera.netlify.app/docs/#include">include</a>
for more information on its features and limitations.</p>
</blockquote>
<!-- TODO: Update `templates-directory` when the usage docs are completed. -->
<div style="break-before: page; page-break-before: always;"></div><h1 id="backlinks"><a class="header" href="#backlinks">Backlinks</a></h1>
<p>Generating backlinks for a Zettelkasten-like note-taking experience is
relatively easy with ReadStor. It requires two separate templates: One for
rendering the book and one for rendering each of its annotations.</p>
<blockquote>
<p><i class="fa fa-info-circle"></i> See the <a href="https://github.com/tnahs/readstor/tree/main/templates/using-backlinks">using-backlinks</a>
templates for a fully working example.</p>
</blockquote>
<h2 id="template-configuration"><a class="header" href="#template-configuration">Template Configuration</a></h2>
<p>First, let's define the configurations for our two templates. They should be
<em>almost</em> identical to one another.</p>
<ul>
<li>
<p><code>group</code> is set to the same value across the two templates. This makes sure
that if we select a grouped <a href="02-templates/./02-03-structure-modes.html">Structure Mode</a>, the templates
will be rendered to the same directory.</p>
</li>
<li>
<p><code>context</code> is set to <code>book</code> for the book template and <code>annotation</code> for the
annotation template.</p>
</li>
<li>
<p><code>structure</code> can be set to any of the four modes, however, <code>nested-grouped</code>
feels the most appropriate as it would place each book into its own directory
and place them all under a directory named after the value for the <code>group</code>
key. See <a href="02-templates/./02-03-structure-modes.html">Structure Modes</a> for more information.</p>
</li>
<li>
<p><code>extension</code> is set to <code>md</code> as the template will be outputting Markdown.</p>
</li>
<li>
<p><code>name-templates</code> can be set to anything as long as the values are identical
between the two templates. It might seem odd to see the values for
<code>name-templates</code> duplicated across the two templates. Shouldn't the book
template define <code>name-templates.book</code> and the annotation template define
<code>name-templates.annotation</code>? Ideally, yes. This need for duplication is the
result of a current <a href="02-templates/./02-05-name-templates.html#limitations">limitation</a> of ReadStor, therefore they
<em>must</em> be identical so the backlinks are correctly generated.</p>
</li>
</ul>
<h3 id="book-template-configuration"><a class="header" href="#book-template-configuration">Book Template Configuration</a></h3>
<pre><code class="language-yaml">group: my-vault
context: book # &lt;- The only difference!
structure: nested-grouped
extension: md
name-templates:
  book: &quot;{{ book.author }} - {{ book.title }}&quot;
  annotation: &quot;{{ annotation.metadata.slugs.created }}-{{ book.slugs.title }}&quot;
  directory: &quot;{{ book.author }} - {{ book.title }}&quot;
</code></pre>
<h3 id="annotation-template-configuration"><a class="header" href="#annotation-template-configuration">Annotation Template Configuration</a></h3>
<pre><code class="language-yaml">group: my-vault
context: annotation # &lt;- The only difference!
structure: nested-grouped
extension: md
name-templates:
  book: &quot;{{ book.author }} - {{ book.title }}&quot;
  annotation: &quot;{{ annotation.metadata.slugs.created }}-{{ book.slugs.title }}&quot;
  directory: &quot;{{ book.author }} - {{ book.title }}&quot;
</code></pre>
<h2 id="template-body"><a class="header" href="#template-body">Template Body</a></h2>
<p>With our configuration all set up, we can now use the <code>links</code> object, which
contains all the rendered <a href="02-templates/./02-05-name-templates.html">Name Templates</a>, to link between
our rendered output files. See <a href="02-templates/./06-03-links.html">Context Reference - Links</a> for more
information.</p>
<h3 id="book-template-body"><a class="header" href="#book-template-body">Book Template Body</a></h3>
<p>The <code>links.annotation</code> object is a dictionary of key:value pairs where the key
is the annotation's <code>id</code> and the value is the rendered output of the
<code>name-templates.annotation</code> template. Here, the <code>id</code> is being discarded by
declaring it an <code>_</code> (by convention only) and never actually using it.</p>
<pre><code class="language-jinja2"># {{ book.author }} - {{ book.title }}

{% for _, link in links.annotations -%}
![[{{ link }}]]
{% endfor %}
</code></pre>
<p>Alternatively we can use the <code>links.directory</code> variable to access the rendered
name of the parent directory. This value is only available if the
<a href="02-templates/./02-03-structure-modes.html">Structure Mode</a> is set to <code>nested</code> or <code>nested-grouped</code>.</p>
<!-- TODO: Verify this works! -->
<pre><code class="language-jinja2"># {{ book.author }} - {{ book.title }}

{% for _, link in links.annotations -%}
![[{{ links.directory }}/{{ link }}]]
{% endfor %}
</code></pre>
<h3 id="annotation-template-body"><a class="header" href="#annotation-template-body">Annotation Template Body</a></h3>
<p>Finally, using the <code>links.book</code> variable we're able to link back to the source
book.</p>
<pre><code class="language-jinja2"># [[{{ links.book }}]]

{{ annotation.body }}

{% if annotation.notes %}notes: {{ annotation.notes }}{% endif -%}
{%- if annotation.tags %}tags: {{ annotation.tags | join(sep=&quot; &quot;) }}{% endif -%}
</code></pre>
<h2 id="output-structure-1"><a class="header" href="#output-structure-1">Output Structure</a></h2>
<pre><code class="language-plaintext">[output-directory]
 ├── my-vault
 │   └── Robert Henri - The Art Spirit
 │       ├── 2021-11-02-180445-the-art-spirit.md
 │       ├── 2021-11-02-181250-the-art-spirit.md
 │       ├── 2021-11-02-181325-the-art-spirit.md
 │       ├── 2021-11-02-181510-the-art-spirit.md
 │       └── Robert Henri - The Art Spirit.md
 │
 ├── [group]
 │    └── ...
 └── ...
</code></pre>
<h2 id="output-rendered-files"><a class="header" href="#output-rendered-files">Output Rendered Files</a></h2>
<p><code>Robert Henri - The Art Spirit.md</code></p>
<pre><code class="language-markdown"># Robert Henri - The Art Spirit

![[2021-11-02-180445-the-art-spirit.md]]
![[2021-11-02-181250-the-art-spirit.md]]
![[2021-11-02-181325-the-art-spirit.md]]
![[2021-11-02-181510-the-art-spirit.md]]
</code></pre>
<p><code>2021-11-02-180445-the-art-spirit.md</code></p>
<pre><code class="language-markdown"># [[Robert Henri - The Art Spirit.md]]

Of course it is not easy to go one’s road. Because of our education we
continually get off our track, but the fight is a good one and there is joy in
it if there is any success at all. After all, the goal is not making art. It is
living a life. Those who live their lives will leave the stuff that is really
art. Art is a result. It is the trace of those who have led their lives. It is
interesting to us because we read the struggle and the degree of success the
man made in his struggle to live. The great question is: “What is worth while?”
The majority of people have failed to ask themselves seriously enough, and have
failed to try seriously enough to answer this question.
</code></pre>
<p><code>2021-11-02-181250-the-art-spirit.md</code></p>
<pre><code class="language-markdown"># [[Robert Henri - The Art Spirit.md]]

We are not here to do what has already been done.
</code></pre>
<p><code>2021-11-02-181325-the-art-spirit.md</code></p>
<pre><code class="language-markdown"># [[Robert Henri - The Art Spirit.md]]

The object of painting a picture is not to make a picture—however unreasonable
this may sound. The picture, if a picture results, is a by-product and may be
useful, valuable, interesting as a sign of what has past. The object, which is
back of every true work of art, is the attainment of a state of being, a state
of high functioning, a more than ordinary moment of existence. In such moments
activity is inevitable, and whether this activity is with brush, pen, chisel,
or tongue, its result is but a by-product of the state, a trace, the footprint
of the state.

tags: #artist #being
</code></pre>
<p><code>2021-11-02-181510-the-art-spirit.m</code></p>
<pre><code class="language-markdown"># [[Robert Henri - The Art Spirit.md]]

Do not let the fact that things are not made for you, that conditions are not
as they should be, stop you. Go on anyway. Everything depends on those who go
on anyway.

tags: #inspiration
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="string-sanitization"><a class="header" href="#string-sanitization">String Sanitization</a></h1>
<p>To avoid any unexpected behavior, all user-provided strings are sanitized
before they are used for naming files or directories. The primary characters that
are removed are the colon <code>:</code>, the forward slash <code>/</code> and line breaks <code>\n</code>
<code>\r</code>.</p>
<p>This following values are sanitized:</p>
<ul>
<li>Template <code>group</code> names</li>
<li>The rendered values from the <code>name-templates</code> key:
<ul>
<li><code>name-templates.book</code></li>
<li><code>name-templates.annotation</code></li>
<li><code>name-templates.directory</code></li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="context-reference"><a class="header" href="#context-reference">Context Reference</a></h1>
<p>Every template is injected with a &quot;context&quot; i.e. the data currently available
to rendering. ReadStor injects three different objects into every template
context: <code>book</code>, <code>annotation</code> (or <code>annotations</code> depending on the
<a href="02-templates/../02-templates/02-02-context-modes.html">Context Mode</a>) and <code>links</code>.</p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody>
<tr><td><code>book</code></td><td>The current <a href="02-templates/./06-01-book.html">Book</a> being rendered.</td></tr>
<tr><td><code>annotation</code></td><td>A single <a href="02-templates/./06-02-annotation.html">Annotation</a> belonging to the current book.</td></tr>
<tr><td><code>annotations</code></td><td>Multiple <a href="02-templates/./06-02-annotation.html">Annotations</a> belonging to the current book.</td></tr>
<tr><td><code>links</code></td><td>A set of <a href="02-templates/./06-03-links.html">Links</a> for generating backlinks between files.</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="book"><a class="header" href="#book">Book</a></h1>
<p>A single <code>book</code> object is injected into all template contexts regardless of
the template's <a href="02-templates/./02-02-context-modes.html">Context Mode</a>.</p>
<h2 id="template-fields---book"><a class="header" href="#template-fields---book">Template Fields - Book</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Attribute</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>book</code></td><td>dictionary</td><td>book object</td></tr>
<tr><td><code>book.title</code></td><td>string</td><td>title</td></tr>
<tr><td><code>book.author</code></td><td>string</td><td>author</td></tr>
<tr><td><code>book.tags</code></td><td>list[string]</td><td>the book's tags</td></tr>
<tr><td><code>book.metadata</code></td><td>dictionary</td><td>metadata</td></tr>
<tr><td><code>book.metadata.id</code></td><td>string</td><td>unique id</td></tr>
<tr><td><code>book.metadata.last_opened</code></td><td>datetime</td><td>date last opened</td></tr>
<tr><td><code>book.slugs</code></td><td>dictionary</td><td>slugs object</td></tr>
<tr><td><code>book.slugs.title</code></td><td>string</td><td>title slugified</td></tr>
<tr><td><code>book.slugs.author</code></td><td>string</td><td>author slugified</td></tr>
</tbody></table>
</div>
<h2 id="example-data---book"><a class="header" href="#example-data---book">Example Data - Book</a></h2>
<pre><code class="language-json">{
  &quot;title&quot;: &quot;The Art Spirit&quot;,
  &quot;author&quot;: &quot;Robert Henri&quot;,
  &quot;tags&quot;: [&quot;#artist&quot;, &quot;#being&quot;, &quot;#inspiration&quot;],
  &quot;metadata&quot;: {
    &quot;id&quot;: &quot;1969AF0ECA8AE4965029A34316813924&quot;,
    &quot;last_opened&quot;: &quot;2021-11-02T18:27:04.781938076Z&quot;
  },
  &quot;slugs&quot;: {
    &quot;title&quot;: &quot;the-art-spirit&quot;,
    &quot;author&quot;: &quot;robert-henri&quot;
  }
}
</code></pre>
<h2 id="example-template---book"><a class="header" href="#example-template---book">Example Template - Book</a></h2>
<pre><code class="language-jinja2">---
title: {{ book.title }}
author: {{ book.author }}
tags: {{ book.tags | join(sep=&quot; &quot;) }}
id: {{ book.metadata.id }}
last-opened: {{ book.metadata.last_opened | date(format=&quot;%Y-%m-%d-%H:%M&quot;) }}
---
</code></pre>
<blockquote>
<p><i class="fa fa-info-circle"></i> Here the <a href="https://tera.netlify.app/docs/#date"><code>date</code></a> filter is used to
format a <code>datetime</code> object into a human-readable date.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="annotation"><a class="header" href="#annotation">Annotation</a></h1>
<p>The number of <code>annotation</code> objects injected into a template depends on
the template's <a href="02-templates/./02-02-context-modes.html">Context Mode</a>. When the
<a href="02-templates/./02-02-context-modes.html#the-annotation-context">Context Mode</a> is set to <code>annotation</code>, a single
<code>annotation</code> object is injected into the template's context. When the
<a href="02-templates/./02-02-context-modes.html#the-book-context">Context Mode</a> is set to <code>book</code>, multiple <code>annotation</code>
objects, under the name <code>annotations</code>, are injected into the template's context.</p>
<h2 id="template-fields---annotation"><a class="header" href="#template-fields---annotation">Template Fields - Annotation</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Attribute</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>annotations</code></td><td>list[dictionary]</td><td>annotation objects</td></tr>
<tr><td><code>annotation</code></td><td>dictionary</td><td>annotation object</td></tr>
<tr><td><code>annotation.body</code></td><td>string</td><td>body</td></tr>
<tr><td><code>annotation.style</code></td><td>string</td><td>highlight style/color</td></tr>
<tr><td><code>annotation.notes</code></td><td>string</td><td>notes</td></tr>
<tr><td><code>annotation.tags</code></td><td>list[string]</td><td>tags</td></tr>
<tr><td><code>annotation.metadata</code></td><td>dictionary</td><td>metadata</td></tr>
<tr><td><code>annotation.metadata.id</code></td><td>string</td><td>unique id</td></tr>
<tr><td><code>annotation.metadata.book_id</code></td><td>string</td><td>book's unique id</td></tr>
<tr><td><code>annotation.metadata.created</code></td><td>datetime</td><td>date created</td></tr>
<tr><td><code>annotation.metadata.modified</code></td><td>datetime</td><td>date modified</td></tr>
<tr><td><code>annotation.metadata.location</code></td><td>string</td><td>location string</td></tr>
<tr><td><code>annotation.metadata.epubcfi</code></td><td>string</td><td><a href="https://w3c.github.io/epub-specs/epub33/epubcfi/">epubcfi</a></td></tr>
<tr><td><code>annotation.metadata.slugs</code></td><td>dictionary</td><td>slugs object</td></tr>
<tr><td><code>annotation.metadata.slugs.created</code></td><td>string</td><td>date created slugified</td></tr>
<tr><td><code>annotation.metadata.slugs.modified</code></td><td>string</td><td>date modified slugified</td></tr>
</tbody></table>
</div><!-- TODO: Add a note on highlight style/color. -->
<!-- TODO: Add a note on tags when tag extraction flag is implemented. -->
<h2 id="example-data---annotation"><a class="header" href="#example-data---annotation">Example Data - Annotation</a></h2>
<pre><code class="language-json">{
  &quot;body&quot;: &quot;Of course it is not easy to go one’s road...&quot;,
  &quot;style&quot;: &quot;blue&quot;,
  &quot;notes&quot;: &quot;&quot;,
  &quot;tags&quot;: [],
  &quot;metadata&quot;: {
    &quot;id&quot;: &quot;9D1B71B1-895C-446F-A03F-50C01146F532&quot;,
    &quot;book_id&quot;: &quot;1969AF0ECA8AE4965029A34316813924&quot;,
    &quot;created&quot;: &quot;2021-11-02T18:04:45.184863090Z&quot;,
    &quot;modified&quot;: &quot;2021-11-02T18:12:30.355533123Z&quot;,
    &quot;location&quot;: &quot;6.26.4.2.446.2.1:0&quot;,
    &quot;epubcfi&quot;: &quot;epubcfi(/6/26[c_9780465008575_ps_Part09_Split4]!/4/2/446/2/1,:0,:679)&quot;,
    &quot;slugs&quot;: {
      &quot;created&quot;: &quot;2021-11-02-180445&quot;,
      &quot;modified&quot;: &quot;2021-11-02-180445&quot;
    }
  }
}
</code></pre>
<h2 id="example-template---annotation"><a class="header" href="#example-template---annotation">Example Template - Annotation</a></h2>
<pre><code class="language-jinja2">{% for annotation in annotations -%}

---

{{ annotation.body }}

{%- if annotation.notes %}notes: {{ annotation.notes }}{% endif -%}
{%- if annotation.tags %}tags: {{ annotation.tags | join(sep=&quot; &quot;) }}{% endif %}

{% endfor %}
</code></pre>
<blockquote>
<p><i class="fa fa-info-circle"></i> Here the <a href="https://tera.netlify.app/docs/#join"><code>join</code></a> filter is used to
join an array of items into a space-separated string.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="links"><a class="header" href="#links">Links</a></h1>
<p>A single <code>links</code> object is injected into all template contexts regardless
of the template's <a href="02-templates/./02-02-context-modes.html">Context Mode</a>. These contain all the file
and directory names rendered from the <code>name-templates</code> key in the template's
config. See <a href="02-templates/./02-05-name-templates.html">Name Templates</a> for more information.</p>
<h2 id="template-fields---links"><a class="header" href="#template-fields---links">Template Fields - Links</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Attribute</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>links</code></td><td>dictionary</td><td>link object</td></tr>
<tr><td><code>links.book</code></td><td>string</td><td>rendered book file name</td></tr>
<tr><td><code>links.annotations</code></td><td>dictionary</td><td>annotations object</td></tr>
<tr><td><code>links.annotations - key:_</code></td><td>string</td><td>annotation id</td></tr>
<tr><td><code>links.annotations - _:value</code></td><td>string</td><td>rendered annotation file name</td></tr>
<tr><td><code>links.directorty</code></td><td>string</td><td>rendered directory name</td></tr>
</tbody></table>
</div>
<h2 id="example-data---links"><a class="header" href="#example-data---links">Example Data - Links</a></h2>
<p>With the following <code>name-templates</code> configuration:</p>
<pre><code class="language-yaml">name-templates:
  book: &quot;{{ book.author }} - {{ book.title }}&quot;
  annotation: &quot;{{ annotation.metadata.slugs.created }}-{{ book.slugs.title }}&quot;
  directory: &quot;{{ book.author }} - {{ book.title }}&quot;
</code></pre>
<pre><code class="language-json">{
  &quot;book&quot;: &quot;Robert Henri - The Art Spirit.md&quot;,
  &quot;annotations&quot;: {
    &quot;C932CE69-8584-4555-834C-797DF84E6825&quot;: &quot;2021-11-02-181250-the-art-spirit.md&quot;,
    &quot;4620564A-0B64-4099-B5D6-6C9116A03AFF&quot;: &quot;2021-11-02-181510-the-art-spirit.md&quot;,
    &quot;9D1B71B1-895C-446F-A03F-50C01146F532&quot;: &quot;2021-11-02-180445-the-art-spirit.md&quot;,
    &quot;3FCC630A-55E6-4D6F-8E8F-DAD7C4E20A1C&quot;: &quot;2021-11-02-181325-the-art-spirit.md&quot;
  },
  &quot;directory&quot;: &quot;Robert Henri - The Art Spirit&quot;
}
</code></pre>
<h2 id="example-template---links"><a class="header" href="#example-template---links">Example Template - Links</a></h2>
<pre><code class="language-jinja2"># {{ book.author }} - {{ book.title }}

{% for _, link in links.annotations -%}
![[{{ link }}]]
{% endfor %}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="apple-books"><a class="header" href="#apple-books">Apple Books</a></h1>
<blockquote>
<p><i class="fa fa-exclamation-circle"></i> This guide assumes that Apple Books
syncing in iCloud Drive is disabled!</p>
</blockquote>
<h2 id="important-note"><a class="header" href="#important-note"><i class="fa fa-exclamation-circle"></i> Important Note</a></h2>
<p>This method will work <strong>only</strong> if the path to the user's home folder <em>has not
changed</em> from when the library was backed up to when its restored.</p>
<p>Doing a few quick searches through the Apple Books directories shows that the
path to the user's home folder has been hard-coded. This is most evident in the
<code>BKLibrary-***.sqlite</code> file which contains absolute paths to files.</p>
<p>If the username <em>must</em> be changed, a search and replace can be attempted.
Whether this will work or not is unconfirmed.</p>
<pre><code class="language-console">$ find ~/Library/Containers/com.apple.BKAgentService -type f \
    -a -exec grep -l --exclude=\*.{htm,html,xhtml} $USER {} +

.../.com.apple.containermanagerd.metadata.plist
.../Container.plist
.../Data/Documents/iBooks/Books/Books.plist
</code></pre>
<pre><code class="language-console">$ find ~/Library/Containers/com.apple.iBooksX* -type f \
    -a -exec grep -l --exclude=\*.{htm,html,xhtml} $USER {} +

.../com.apple.iBooksX/.com.apple.containermanagerd.metadata.plist
.../com.apple.iBooksX/Container.plist
.../com.apple.iBooksX/Data/Documents/BKLibrary/BKLibrary-1-091020131601.sqlite-wal
.../com.apple.iBooksX/Data/Documents/BKLibrary/BKLibrary-1-091020131601.sqlite
.../com.apple.iBooksX-SecureUserDefaults/.com.apple.containermanagerd.metadata.plist
.../com.apple.iBooksX-SecureUserDefaults/Container.plist
.../com.apple.iBooksX.CacheDelete/.com.apple.containermanagerd.metadata.plist
.../com.apple.iBooksX.CacheDelete/Container.plist
.../com.apple.iBooksX.DiskSpaceEfficiency/.com.apple.containermanagerd.metadata.plist
.../com.apple.iBooksX.DiskSpaceEfficiency/Container.plist
.../com.apple.iBooksX.SharingExtension/.com.apple.containermanagerd.metadata.plist
.../com.apple.iBooksX.SharingExtension/Container.plist
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="backup-apple-books-library"><a class="header" href="#backup-apple-books-library">Backup Apple Books' Library</a></h1>
<h2 id="what-to-archive"><a class="header" href="#what-to-archive">What to Archive</a></h2>
<p>Apple Books stores the bulk of its data in two locations:</p>
<ol>
<li>
<p>The location of EPUBs, PDFs, Audiobooks, etc.:</p>
<pre><code class="language-plaintext">~/Library/Containers/com.apple.BKAgentService
</code></pre>
</li>
<li>
<p>The location of the library's databases: <code>BKLibrary***.sqlite</code> and <code>AEAnnotation***.sqlite</code>:</p>
<pre><code class="language-plaintext">~/Library/Containers/com.apple.iBooksX
</code></pre>
</li>
</ol>
<p>However, only archiving and restoring these directories might miss some of the metadata.</p>
<pre><code class="language-console">$ find ~/Library/Containers -type d -name &quot;*Books*&quot;

./com.apple.BKAgentService/Data/Documents/iBooks
./com.apple.BKAgentService/Data/Documents/iBooks/Books
./com.apple.iBooksX
./com.apple.iBooksX/Data/Documents/BCCloudKit-iBooks
./com.apple.iBooksX/Data/Documents/BCCloudAsset-iBooks
./com.apple.iBooksX/Data/Documents/BKBookstore
./com.apple.iBooksX/Data/Library/Caches/com.apple.iBooksX
./com.apple.iBooksX.CacheDelete
./com.apple.iBooksX.DiskSpaceEfficiency
./com.apple.iBooksX.SharingExtension
./com.apple.iBooksX-SecureUserDefaults
</code></pre>
<p>And using <code>BK</code> as a proxy for <code>Books</code>:</p>
<pre><code class="language-console">$ find ~/Library/Containers -type d -name &quot;*BK*&quot;

./com.apple.BKAgentService
./com.apple.iBooksX/Data/Documents/BKSeriesDatabase
./com.apple.iBooksX/Data/Documents/BKLibraryDataSourceDevelopment
./com.apple.iBooksX/Data/Documents/BKLibrary
./com.apple.iBooksX/Data/Documents/BKBookstore
</code></pre>
<p>So it's good to assume any directory with the string <code>Books</code> or <code>BK</code> is
important. Therefore these two globs will be archived:</p>
<pre><code class="language-plaintext">~/Library/Containers/com.apple.BK*
~/Library/Containers/com.apple.iBooks*
</code></pre>
<h2 id="archiving-the-library"><a class="header" href="#archiving-the-library">Archiving The Library</a></h2>
<p>Run the following <code>rsync</code> command:</p>
<pre><code class="language-console">rsync \
    --verbose \
    --progress \
    --archive \
    --extended-attributes \
    $HOME/Library/Containers/com.apple.BK* \
    $HOME/Library/Containers/com.apple.iBooks* \
    [PATH_TO_ARCHIVE]
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="restore-apple-books-library"><a class="header" href="#restore-apple-books-library">Restore Apple Books' Library</a></h1>
<p>Make sure Apple Books is closed or run:</p>
<pre><code class="language-console">osascript -e 'tell application &quot;Books&quot; to quit'
</code></pre>
<p>Delete the current library using the same globs.</p>
<!-- TODO: Add note about `Group Containers` -->
<pre><code class="language-console">rm -rf $HOME/Library/Containers/com.apple.BK*
rm -rf $HOME/Library/Containers/com.apple.iBooks*
rm -rf $HOME/Library/Group\ Containers/group.com.apple.iBooks
</code></pre>
<p>Extract the archive directly into <code>~/Library/Containers</code>.</p>
<p>The trailing slash after <code>[PATH_TO_ARCHIVE]</code> here is important. It tells <code>rsync</code>
to move the <em>contents</em> of this directory into another. Otherwise it would move
the directory as a whole.</p>
<pre><code class="language-console">rsync \
    --verbose \
    --progress \
    --archive \
    [PATH_TO_ARCHIVE]/ \
    $HOME/Library/Containers/
</code></pre>
<p>That's it! At this point the library should be fully restored.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
    </body>
</html>
